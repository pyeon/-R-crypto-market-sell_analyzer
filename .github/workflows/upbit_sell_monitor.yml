name: Upbit Sell Signal Monitor

on:
  schedule:
    # 30ë¶„ë§ˆë‹¤ ì‹¤í–‰ (ê¸‰ë½ ë¹ ë¥¸ ê°ì§€)
    - cron: '0,30 * * * *'
  
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  contents: write  # Git pushë¥¼ ìœ„í•´ í•„ìˆ˜!

jobs:
  monitor-sell-signals:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: Install dependencies
      run: |
        pip install pyupbit pandas numpy requests pytz ta openpyxl
    
    - name: Create config file
      run: |
        cat > config.py << 'EOF'
        # í…”ë ˆê·¸ëž¨ ì„¤ì •
        BOT_TOKEN = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
        CHAT_ID = "${{ secrets.TELEGRAM_CHAT_ID }}"
        
        # ============================================
        # ê°€ê²© íŒ¨í„´ ë¶„ì„ ì„¤ì •
        # ============================================
        
        # 10ë¶„ë´‰ ë°ì´í„° ê°œìˆ˜ (72ê°œ = 12ì‹œê°„)
        MINUTE_10_COUNT = 72
        
        # 60ë¶„ë´‰ ë°ì´í„° ê°œìˆ˜ (24ê°œ = 24ì‹œê°„)
        MINUTE_60_COUNT = 24
        
        # ë‹¨ê¸° ê¸‰ë½ ê°ì§€ (10ë¶„ë´‰ ê¸°ì¤€)
        QUICK_DROP_LOOKBACK = 18  # ìµœê·¼ Nê°œ ë´‰ ì¤‘ ìµœê³ ê°€ í™•ì¸ (18ê°œ = 3ì‹œê°„)
        QUICK_DROP_THRESHOLD = 5.0  # ê¸‰ë½ ìž„ê³„ê°’ (%)
        
        # ì¤‘ê¸° ê³ ì  ëŒ€ë¹„ í•˜ë½ (60ë¶„ë´‰ ê¸°ì¤€)
        DROP_FROM_HIGH_12H_THRESHOLD = 8.0  # 12ì‹œê°„ ê³ ì  ëŒ€ë¹„ í•˜ë½ ìž„ê³„ê°’ (%)
        
        # ê¸‰ë“± í›„ í•˜ë½ ì „í™˜ ê°ì§€
        SURGE_6H_THRESHOLD = 15.0  # 6ì‹œê°„ ê¸‰ë“± ìž„ê³„ê°’ (%)
        CHANGE_1H_THRESHOLD = -3.0  # 1ì‹œê°„ í•˜ë½ ìž„ê³„ê°’ (%)
        
        # ë³€ë™ì„± ì²´í¬
        VOLATILITY_CHECK_CANDLES = 6  # ìµœê·¼ Nê°œ ë´‰ì˜ ë³€ë™ì„± í™•ì¸
        VOLATILITY_THRESHOLD = 3.0  # í‰ê·  ë³€ë™ë¥  ìž„ê³„ê°’ (%)
        
        # í•„í„°ë§ (ë„ˆë¬´ ì•½í•œ ì‹ í˜¸ ì œì™¸)
        MIN_QUICK_DROP = 2.0  # ìµœì†Œ ë‹¨ê¸° ê¸‰ë½ (%)
        MIN_DROP_12H = 3.0  # ìµœì†Œ 12ì‹œê°„ í•˜ë½ (%)
        
        # ============================================
        # ê±°ëž˜ëŸ‰ ë¶„ì„ ì„¤ì •
        # ============================================
        
        # ê±°ëž˜ëŸ‰ ê°ì†Œ ì¶”ì„¸ í™•ì¸ ì¼ìˆ˜
        VOLUME_DECLINE_DAYS = 3
        
        # ê°€ê²©-ê±°ëž˜ëŸ‰ ë‹¤ì´ë²„ì „ìŠ¤
        DIVERGENCE_LOOKBACK_DAYS = 7
        DIVERGENCE_PRICE_THRESHOLD = 10.0  # ê°€ê²© ìƒìŠ¹ ìž„ê³„ê°’ (%)
        DIVERGENCE_VOLUME_THRESHOLD = -20.0  # ê±°ëž˜ëŸ‰ ê°ì†Œ ìž„ê³„ê°’ (%)
        
        # ============================================
        # í˜¸ê°€ì°½ ë¶„ì„ ì„¤ì •
        # ============================================
        
        # ë§¤ë„/ë§¤ìˆ˜ ë¹„ìœ¨ ìž„ê³„ê°’
        ORDERBOOK_THRESHOLD = 1.3  # ë§¤ë„ê°€ ë§¤ìˆ˜ë³´ë‹¤ 1.3ë°° ì´ìƒ
        
        # ============================================
        # ê¸°ìˆ ì  ì§€í‘œ ì„¤ì •
        # ============================================
        
        # RSI
        RSI_OVERBOUGHT = 70  # ê³¼ë§¤ìˆ˜ ê¸°ì¤€
        RSI_HIGH = 60  # ê³ ì ê¶Œ ê¸°ì¤€
        
        # ë³¼ë¦°ì € ë°´ë“œ
        BB_HIGH_THRESHOLD = 80  # ìƒë‹¨ ê·¼ì ‘ ê¸°ì¤€ (%)
        
        # ìŠ¤í† ìºìŠ¤í‹±
        STOCH_OVERBOUGHT = 80  # ê³¼ë§¤ìˆ˜ ê¸°ì¤€
        STOCH_HIGH = 70  # ê³ ì ê¶Œ ê¸°ì¤€
        
        # ============================================
        # ë§¤ë„ ë‹¨ê³„ ê¸°ì¤€
        # ============================================
        
        # ì‹ í˜¸ ê°•ë„ ê¸°ì¤€ (10ê°œ ì§€í‘œ ì¤‘)
        SELL_STAGE_IMMEDIATE = 7  # ì¦‰ì‹œë§¤ë„: 7ê°œ ì´ìƒ
        SELL_STAGE_PREPARE = 5    # ë§¤ë„ì¤€ë¹„: 5-6ê°œ
        SELL_STAGE_REVIEW = 3     # ë§¤ë„ê²€í† : 3-4ê°œ
        EOF
    
    - name: Run sell signal monitor
      run: |
        python upbit_sell_monitor_actions.py
    
    - name: Commit and push if changed
      run: |
        git config --global user.name 'GitHub Actions Bot'
        git config --global user.email 'actions@github.com'
        git add market_data/ analysis_reports/ upbit_sell_signals_v2.xlsx
        
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ðŸ”´ ë§¤ë„ ì‹ í˜¸ ë¶„ì„ ì—…ë°ì´íŠ¸ - $(date -u +'%Y-%m-%d %H:%M:%S') UTC"
          git push
        fi
